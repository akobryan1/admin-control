<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Final Exam Results Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
      padding: 20px;
    }
    h1 {
      margin-bottom: 6px;
    }
    .subtitle { color: #9ca3af; margin-bottom: 20px; }

    .status { margin-bottom: 15px; font-size: 0.9rem; }
    .status.error { color: #f87171; }

    .accordion details {
      background: #0f172a;
      border: 1px solid #1e293b;
      border-radius: 6px;
      margin-bottom: 10px;
      padding: 10px;
    }
    summary {
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #1e293b;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background: #1e293b;
      color: #e5e7eb;
    }
    tr:nth-child(even) { background: #0f1a30; }
    tr:nth-child(odd) { background: #0b1424; }
  </style>
</head>
<body>

<h1>Final Exam Submissions</h1>
<div class="subtitle">
  Loaded from: <code>finals-exam / ANSCI2025Final / submissions</code>
</div>

<div id="status" class="status">Initializing…</div>
<div id="container"></div>

<!-- FIREBASE MODULES -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const statusEl = document.getElementById("status");
  const container = document.getElementById("container");

  function setStatus(msg, isError = false) {
    statusEl.textContent = msg;
    statusEl.classList.toggle("error", isError);
    console.log("[STATUS]", msg);
  }

  // FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyB-idZOq8h9sVttNdzXE2t8FMoYI_snq7g",
    authDomain: "kuya-quiz-100.firebaseapp.com",
    projectId: "kuya-quiz-100",
    storageBucket: "kuya-quiz-100.firebasestorage.app",
    messagingSenderId: "74623975270",
    appId: "1:74623975270:web:dec2b21dbee017292952a7"
  };

  console.log("[DEBUG] Initializing Firebase…");
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadData() {
    try {
      setStatus("Loading data…");

      // Correct path for only ANSCI2025Final
      const submissionsRef = collection(db,
        "finals-exam",
        "ANSCI2025Final",
        "submissions"
      );

      const snap = await getDocs(submissionsRef);
      console.log("[DEBUG] submissions count:", snap.size);

      if (snap.empty) {
        setStatus("No submissions found.");
        return;
      }

      const records = [];
      snap.forEach(doc => {
        const data = doc.data();
        console.log("[DEBUG] record:", doc.id, data);

        records.push({
          id: doc.id,
          name: data.Name ?? "Unknown",
          course: data.Course ?? "Unknown",
          score: data.Score ?? "—",
          section: data.Section ?? "—"
        });
      });

      render(records);
      setStatus("Loaded " + records.length + " submissions.");
    }
    catch (err) {
      console.error(err);
      setStatus("Error: " + err.message, true);
    }
  }

  function render(records) {
    const html = `
      <details open>
        <summary>ANSCI2025Final – ${records.length} submissions</summary>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Course</th>
              <th>Section</th>
              <th>Score</th>
              <th>Attempt ID</th>
            </tr>
          </thead>
          <tbody>
            ${records.map(r => `
              <tr>
                <td>${r.name}</td>
                <td>${r.course}</td>
                <td>${r.section}</td>
                <td>${r.score}</td>
                <td>${r.id}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      </details>
    `;

    container.innerHTML = html;
  }

  loadData();
</script>

</body>
</html>
